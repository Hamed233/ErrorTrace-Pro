<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ErrorTrace Pro - Interactive Demo</title>
    <link href="https://cdn.replit.com/agent/bootstrap-agent-dark-theme.min.css" rel="stylesheet">
    <style>
        body {
            padding: 20px;
        }
        .code-editor {
            font-family: 'Courier New', Courier, monospace;
            min-height: 300px;
            resize: vertical;
        }
        .solution-item {
            margin-bottom: 10px;
            padding: 8px;
            border-left: 3px solid #0d6efd;
            background-color: rgba(13, 110, 253, 0.1);
        }
        .error-type {
            color: #dc3545;
            font-weight: bold;
        }
        .error-traceback {
            font-family: 'Courier New', Courier, monospace;
            white-space: pre-wrap;
            word-wrap: break-word;
            background-color: #2b2b2b;
            color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            overflow-x: auto;
        }
        .solution-heading {
            color: #0d6efd;
            margin-top: 20px;
        }
        .header-logo {
            font-size: 2.5rem;
            margin-right: 10px;
        }
        .variables-section {
            margin-top: 20px;
        }
        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
        }
        .loading-spinner {
            width: 3rem;
            height: 3rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="d-flex align-items-center pb-3 mb-4 border-bottom">
            <span class="header-logo">üîç</span>
            <span class="fs-4">ErrorTrace Pro</span>
        </header>

        <div class="p-4 mb-4 bg-body-tertiary rounded-3">
            <div class="container-fluid py-3">
                <h1 class="display-5 fw-bold">Interactive Error Debugger</h1>
                <p class="col-md-8 fs-4">
                    Try out ErrorTrace Pro's enhanced error handling capabilities. 
                    Write or select Python code that generates an error and see the detailed traceback and solution suggestions.
                </p>
            </div>
        </div>

        <div class="row mb-4">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">Code Editor</h5>
                        <div class="dropdown">
                            <button class="btn btn-outline-secondary dropdown-toggle" type="button" id="examplesDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                Examples
                            </button>
                            <ul class="dropdown-menu" id="examples-menu" aria-labelledby="examplesDropdown">
                                <!-- Examples will be loaded here -->
                            </ul>
                        </div>
                    </div>
                    <div class="card-body">
                        <textarea id="code-editor" class="form-control code-editor" placeholder="# Write your Python code here..."></textarea>
                    </div>
                    <div class="card-footer">
                        <button id="execute-btn" class="btn btn-primary">Execute Code</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="loading" id="loading">
            <div class="spinner-border loading-spinner" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p>Processing code...</p>
        </div>

        <div id="result-section" style="display: none;">
            <div id="error-section" style="display: none;">
                <div class="card mb-4">
                    <div class="card-header bg-danger text-white">
                        <h5 class="mb-0">Error Detected</h5>
                    </div>
                    <div class="card-body">
                        <h4 id="error-title" class="error-type"></h4>
                        <p id="error-message"></p>
                        <h5>Traceback:</h5>
                        <div id="error-traceback" class="error-traceback"></div>
                    </div>
                </div>

                <div class="card mb-4" id="solutions-card" style="display: none;">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">Solution Suggestions</h5>
                    </div>
                    <div class="card-body">
                        <ul id="solutions-list" class="list-group list-group-flush">
                            <!-- Solutions will be added here -->
                        </ul>
                    </div>
                </div>
            </div>

            <div id="success-section" style="display: none;">
                <div class="card mb-4">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0">Success</h5>
                    </div>
                    <div class="card-body">
                        <p>Code executed successfully!</p>
                    </div>
                </div>

                <div class="card variables-section" id="variables-card" style="display: none;">
                    <div class="card-header">
                        <h5 class="mb-0">Variables</h5>
                    </div>
                    <div class="card-body">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Value</th>
                                </tr>
                            </thead>
                            <tbody id="variables-table">
                                <!-- Variables will be added here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-5">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">About ErrorTrace Pro</h5>
                    </div>
                    <div class="card-body">
                        <h4>Features</h4>
                        <ul>
                            <li><strong>Visual Traceback Mapping:</strong> Beautiful, colorful, and informative tracebacks</li>
                            <li><strong>Common Solution Database:</strong> Suggests fixes for known exceptions</li>
                            <li><strong>Auto-logging to Cloud:</strong> Log exceptions to various cloud providers</li>
                            <li><strong>Easy Integration:</strong> Works with existing Python code</li>
                            <li><strong>CLI Tool:</strong> Run scripts with enhanced error handling</li>
                        </ul>
                        <h4>Installation</h4>
                        <pre><code>pip install errortrace-pro</code></pre>
                        <h4>Basic Usage</h4>
                        <pre><code>import errortrace_pro

# Install as global exception handler
errortrace_pro.install()</code></pre>
                    </div>
                </div>
            </div>
        </div>

        <footer class="pt-3 mt-4 text-muted border-top">
            ErrorTrace Pro &copy; 2025
        </footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const codeEditor = document.getElementById('code-editor');
            const executeBtn = document.getElementById('execute-btn');
            const resultSection = document.getElementById('result-section');
            const errorSection = document.getElementById('error-section');
            const successSection = document.getElementById('success-section');
            const errorTitle = document.getElementById('error-title');
            const errorMessage = document.getElementById('error-message');
            const errorTraceback = document.getElementById('error-traceback');
            const solutionsCard = document.getElementById('solutions-card');
            const solutionsList = document.getElementById('solutions-list');
            const variablesCard = document.getElementById('variables-card');
            const variablesTable = document.getElementById('variables-table');
            const examplesMenu = document.getElementById('examples-menu');
            const loading = document.getElementById('loading');

            // Load examples
            fetch('/examples')
                .then(response => response.json())
                .then(data => {
                    data.examples.forEach(example => {
                        const li = document.createElement('li');
                        const a = document.createElement('a');
                        a.classList.add('dropdown-item');
                        a.href = '#';
                        a.textContent = example.title;
                        a.onclick = function() {
                            codeEditor.value = example.code;
                            return false;
                        };
                        li.appendChild(a);
                        examplesMenu.appendChild(li);
                    });
                });

            // Execute code
            executeBtn.addEventListener('click', function() {
                const code = codeEditor.value;
                
                if (!code.trim()) {
                    alert('Please enter some code first');
                    return;
                }

                // Show loading
                loading.style.display = 'block';
                resultSection.style.display = 'none';
                
                // Send code to server
                fetch('/execute', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ code: code })
                })
                .then(response => response.json())
                .then(data => {
                    // Hide loading
                    loading.style.display = 'none';
                    resultSection.style.display = 'block';
                    
                    if (data.success) {
                        // Show success section
                        errorSection.style.display = 'none';
                        successSection.style.display = 'block';
                        
                        // Check if variables exist
                        if (data.variables && Object.keys(data.variables).length > 0) {
                            variablesCard.style.display = 'block';
                            variablesTable.innerHTML = '';
                            
                            // Add variables to table
                            for (const [name, value] of Object.entries(data.variables)) {
                                const row = document.createElement('tr');
                                const nameCell = document.createElement('td');
                                const valueCell = document.createElement('td');
                                
                                nameCell.textContent = name;
                                valueCell.textContent = value;
                                
                                row.appendChild(nameCell);
                                row.appendChild(valueCell);
                                variablesTable.appendChild(row);
                            }
                        } else {
                            variablesCard.style.display = 'none';
                        }
                    } else {
                        // Show error section
                        errorSection.style.display = 'block';
                        successSection.style.display = 'none';
                        
                        // Fill error details
                        errorTitle.textContent = data.error_type;
                        errorMessage.textContent = data.error_message;
                        
                        // Handle traceback (try to preserve formatting)
                        errorTraceback.innerHTML = data.traceback.replace(/\n/g, '<br>');
                        
                        // Check if solutions exist
                        if (data.solutions && data.solutions.length > 0) {
                            solutionsCard.style.display = 'block';
                            solutionsList.innerHTML = '';
                            
                            // Add solutions to list
                            data.solutions.forEach((solution, index) => {
                                const li = document.createElement('li');
                                li.classList.add('list-group-item', 'solution-item');
                                li.textContent = solution;
                                solutionsList.appendChild(li);
                            });
                        } else {
                            solutionsCard.style.display = 'none';
                        }
                    }
                })
                .catch(error => {
                    // Hide loading
                    loading.style.display = 'none';
                    
                    console.error('Error:', error);
                    alert('An error occurred while executing the code. Please try again.');
                });
            });
        });
    </script>
</body>
</html>